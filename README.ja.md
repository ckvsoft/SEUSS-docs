![Logo](views/static/images/logo-seuss.png?raw=true "SEUSS")

# スース

### [SEUSS -> Smart Ess ユニット スポットマーケット スイッチャー]

#### バグを報告し、改善を提案してください。すでにご参加いただいている皆様、ありがとうございます。

###### これに拡張機能を提供したい場合は、開発ブランチでプル リクエストを送信してください。バグ修正の場合は、メイン ブランチでプル リクエストを行うこともできます。

### このソフトウェアは何をするものですか?

これは、時間ごとの動的エネルギー価格が安いときに適切なタイミングで ESS ユニット (コントローラー) をオンにする Python 3 アプリケーションです。または、価格が非常に高い場合の放出に使用されます。

#### 現在サポートされているシステムは次のとおりです。

### ESSユニット

* * *

-   **_Victron Venus OS エネルギー貯蔵システム（MultiPlus II シリーズなど）_**

* * *

### スポットマーケット

* * *

-   **_答え_**
-   **_エンツォ-E_**
-   **_ティバー_**

* * *

ESSユニット（コントローラー）の制御はmqtt経由で行われます。このコントロールの利点は次のとおりです。
このアプリケーションは VenusOS 上で直接実行する必要はありません。 D-BUSによる直接制御も検討中

# テスト済み

このバージョンでは成功しました

* * *

-   **_Linux Ubuntu >= 22.04_**
-   **_Venus OS ラズベリー >= vz.12_**

* * *

テストされた

# インストール

GitHub リポジトリからインストール スクリプトをダウンロードし、ターミナルで次のコマンドを実行します。

    wget -O seuss_install.sh https://raw.githubusercontent.com/ckvsoft/SEUSS/dev/scripts/seuss_install.sh`

追加のオプションを指定してインストーラー スクリプトを実行し、サブディレクトリ内のすべてのものを検査用に準備します。例えば：

    bash seuss_install.sh`

デフォルトのディレクトリは /data/seuss (Venus OS) ですが、環境変数 TARGET_DIRECTORY を使用して、オプションで別のディレクトリを指定することもできます。

    TARGET_DIRECTORY=/opt/seuss bash seuss_install.sh`

Cerbo GX では、ファイルシステムは読み取り専用でマウントされます。見る[ｈっｔｐｓ：／／ｗっｗ。ゔぃｃｔろねねｒｇｙ。こｍ／ぃゔぇ／っｃｇｘ：ろおｔ＿あっせっｓ](https://www.victronenergy.com/live/ccgx:root_access)。
ファイルシステムを書き込み可能にするには、インストール スクリプトを実行する前に次のコマンドを実行する必要があります。

    /opt/victronenergy/swupdate-scripts/resize2fs.sh

# 構成

後`SEUSS`が正常にインストールされている場合、Web サイトは IP アドレスとポート 5000 で利用できます。`Computer/VenusOS`どの上で`SEUSS`設置されました。

-   ログ ファイルを表示またはダウンロードできます。
-   さらに、設定は次を使用して実行できます。[構成エディター]メニュー項目。
-   ほとんどのポイントのツールヒントがここに表示されます。

#### ログビューア

-   ![Logo](views/static/images/logviewer.png?raw=true "SEUSS Log Viewer")

#### 構成エディター - ESS ユニット

-   ![Logo](views/static/images/configeditor_ess.png?raw=true "SEUSS Config Editor")

#### 構成エディター - PV パネル

-   ![Logo](views/static/images/configeditor_panels.png?raw=true "SEUSS Config Editor")

これらは設定の説明にも記載されています。
構成ファイルで作業することを好む人には、config.toml があります。

# 設定

## 一般的な

| 設定              | 意味                                                                                      |
| --------------- | --------------------------------------------------------------------------------------- |
| `time_zone`     | 地理的位置に基づいて操作を正確なタイミングで行うために不可欠です。<br/>のようなフォーマット`Europe/Vienna`、`Europe/Amsterdam`、 。。。 |
| `log_file_path` | ログ ファイルが保存される代替パスを設定します。                                                                |
| `log_level`     | 使用されるログレベルは次のとおりです。`INFO`、`WARNING`、`ERROR`そして`DEBUG`。見る[ログレベル](#loglevels)             |

## 価格

#### 価格を変更してください (Awattar (セント/kWh を表示) または Entsoe API (EUR/MWh を表示) のどちらを使用しているかに関係なく、常にセント/kWh を使用してください / 税抜正味価格)。

| 設定                                         | 意味                                                                                                                                                                                                                                                                               |
| ------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `use_second_day`                           | `enable/disable`今日と明日の価格が利用可能になった場合に比較する<br/>注: これを有効にし、数日間にわたって価格が下がった場合、最低価格に達するまでの数日間は充電や切り替えが行われない可能性があります。                                                                                                                                                                  |
| `number_of_lowest_prices_for_charging`     | ここでは 2 つのモードを使用できます。<br/>モード1:<br/>_充電が行われる、または行われる可能性のある最も安い価格の数。ここに整数を入力します<br/>モード2:<br/>_ここで、価格の数は平均価格に基づいて決定されます。このモードでは、10 進数を入力します。例えば。平均より 85% 低いすべての価格を受け取るには 0.85。ここで重要なのは、カンマ値の指定です。 1.0 では、平均価格の 100% が使用されると想定されますが (意味はありません)、1 を入力すると 1 つの最も安い価格になります。            |
| `number_of_highest_prices_for_discharging` | ここでは 2 つのモードを使用できます。<br/>モード1:<br/>_放出が行われる、または行われる可能性のある最も高価な価格の数。ここに整数を入力します<br/>モード2:<br/>_ここで、価格の数は平均価格に基づいて決定されます。このモードでは、10 進数を入力します。例えば。平均より 25% 高いすべての価格を受け取るには 1.25。<br/>ここで重要なのは、カンマ値の指定です。 1.0 では、平均価格の 100% が使用されると想定されます (意味はありません)。ただし、1 を入力すると、最も高価な 1 つの価格になります。 |
| `charging_price_limit`                     | この価格以下では常に充電が有効になります<br/>放出が実行されるべき、または実行される可能性がある最も高価な価格の数                                                                                                                                                                                                                      |

## ESSユニット

### ビクトロン

| 設定                    | 意味                                                                                                                                                                                                                                                               |
| :-------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `use_vrm`             | このポイントが有効 (true) の場合、VRM ポータル経由で Victron への接続が試行されます。<br/>これには、VRM ポータルのユーザー/パスワードが必要です                                                                                                                                                                          |
| `ip_address`          | Victron のローカル IP アドレス。<br/>これは次の場合に必須です`use_vrm`無効になっています (false)。<br/>それ以外の場合、このフィールドは空のままになります                                                                                                                                                                 |
| `unit_id`             | VRMポータルID<br/>で見つけることができます`Settings / VRM online portal / VRM Portal Id`。<br/>注: VRM ポータルを使用していない場合でも、Victron にアクセスするにはこの ID が必要です                                                                                                                               |
| `user`                | VRMポータルへの接続に使用するメールアドレス                                                                                                                                                                                                                                          |
| `password`            | VRMポータルへの接続に使用するパスワード                                                                                                                                                                                                                                            |
| `max_discharge_power` | デフォルト: -1<br/>使用する場合`Limit inverter power`ESS メニューでは、この値をここに入力する必要があります。<br/>インバータが に設定されている場合`Discharge false`このアプリによってこの値は ESS で上書きされます。<br/>この制限は、ESS の放電モードで設定されます。<br/>制限が設定されていない場合は、値をそのままにしておきます。`-1`。<br/>例: Enter`1000`排出を制限する`1000W`、 入力`-1`フルパワーに向けて |
| `primary`             | このマーケットが有効な場合、このポイントはプライマリ マーケットとして設定します                                                                                                                                                                                                                         |
| `enabled`             | このエントリを使用するには、次のようにする必要があります`enabled`。さもないと`disabled`                                                                                                                                                                                                            |

## スポットマーケット

### 答え

| 設定        | 意味                                                    |
| :-------- | :---------------------------------------------------- |
| `country` | AT または DE の場所を選択してください                                |
| `primary` | このマーケットが有効な場合、このポイントはプライマリ マーケットとして設定します              |
| `enabled` | このエントリを使用するには、次のようにする必要があります`enabled`。さもないと`disabled` |

### エンツォは

| 設定           | 意味                                                                                                                                                                                                                                                                                                                                                                                                                      |
| :----------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `api_token`  | 無料の API セキュリティ トークンを取得する方法:<br/>1. に移動します[ｈっｔｐｓ：／／ｔらんｓぱれんｃｙ。えんつぉえ。えう／](https://transparency.entsoe.eu/)--> 登録してアカウントを作成する<br/>2. に電子メールを送信します[ｔらんｓぱれんｃｙ＠えんつぉえ。えう](mailto:transparency@entsoe.eu)件名に「Restful API アクセス」を含める<br/>3. ENTSO-E ヘルプデスクは、3 営業日以内にお客様のリクエストに回答します。<br/>4. 次の場所でセキュリティ トークンを生成します。[ｈっｔｐｓ：／／ｔらんｓぱれんｃｙ。えんつぉえ。えう／うｓｒｍ／うせｒ／みゃっこうんつぇっちんｇｓ](https://transparency.entsoe.eu/usrm/user/myAccountSettings) |
| `in_domain`  | 受信ドメインキーと送信ドメインキーを確認するには、次の場所にアクセスしてください。<br/>[ｈっｔｐｓ：／／ｗっｗ。えんつぉえ。えう／だた／えねｒｇｙーいでんちふぃかちおんーこでｓーえいｃ／えいｃーあれあーこでｓーまｐ／](https://www.entsoe.eu/data/energy-identification-codes-eic/eic-area-codes-map/)                                                                                                                                                                                                                        |
| `out_domain` | のように`in_domain`                                                                                                                                                                                                                                                                                                                                                                                                         |
| `primary`    | このマーケットが有効な場合、このポイントはプライマリ マーケットとして設定します                                                                                                                                                                                                                                                                                                                                                                                |
| `enabled`    | このエントリを使用するには、次のようにする必要があります`enabled`。さもないと`disabled`                                                                                                                                                                                                                                                                                                                                                                   |

### ティバー

| 設定           | 意味                                                                                                                                                                                                                                                                                                                             |
| :----------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `api_token`  | tibber_api_key を取得するには:<br/>1. 無料または顧客の Tibber アカウントを使用して、次の場所にログインします。[ｈっｔｐｓ：／／でゔぇぉぺｒ。ちっべｒ。こｍ／せっちんｇｓ／あっせっｓーとけん](https://developer.tibber.com/settings/access-token)<br/>2. 必要なスコープを選択してトークンを作成します (「価格」を選択)<br/>3. このリンクを使用して、スマートフォンで無料アカウントを作成します。[ｈっｔｐｓ：／／ちっべｒ。こｍ／で／いんゔぃて／おｊｇｆｂｘ２え](https://tibber.com/de/invite/ojgfbx2e) |
| `price_unit` | に設定：<br/>「energy」はスポットマーケット価格を使用します（デフォルト）、<br/>「total」は税金と手数料を含む合計価格を使用します。<br/>「tax」は税金と手数料のみを使用します                                                                                                                                                                                                                          |
| `primary`    | このマーケットが有効な場合、このポイントはプライマリ マーケットとして設定します                                                                                                                                                                                                                                                                                       |
| `enabled`    | このエントリを使用するには、次のようにする必要があります`enabled`。さもないと`disabled`                                                                                                                                                                                                                                                                          |

## 太陽光発電パネル

| 設定          | 意味                                                       |
| :---------- | :------------------------------------------------------- |
| `LocLat`    | 緯度                                                       |
| `LocLon`    | 経度                                                       |
| `angle`     | パネルの角度 0 (水平) … 90 (垂直)                                  |
| `direction` | 平面方位角、-180 … 180 (-180 = 北、-90 = 東、0 = 南、90 = 西、180 = 北) |
| `totPower`  | インストールされているモジュールの電力 (キロワット)                              |
| `enabled`   | このエントリを使用するには、次のようにする必要があります`enabled`。さもないと`disabled`    |

* * *

## ログレベル

### `ERROR`

の`ERROR`ログ レベルは、特定の操作の実行を妨げるアプリケーション内のエラー状態を示します。アプリケーションは機能またはパフォーマンスのレベルを下げても機能し続けることができますが、<br/>`ERROR`ログは、すぐに調査する必要がある問題を示しています。

### `WARN`

に記録されるイベント`WARN`レベルは通常、予期しない何かが発生したことを示します
が発生しましたが、アプリケーションは当面は正常に機能し続けることができます。
また、問題が発生する前に速やかに対処する必要がある状態を示すためにも使用されます。
アプリケーションの問題にエスカレートします。

### `INFO`

の`INFO`レベルは、システムにとって重要なイベントをキャプチャします。
アプリケーションのビジネス目的。このようなイベントは、システムが正常であることを示すためにログに記録されます。
正常に動作しています。通常、運用システムではデフォルトでこのレベルのログが記録されます。
アプリケーションの通常の動作の概要が誰にでも見えるようにするため
 ログを確認します。

### `DEBUG`

の`DEBUG`レベルは、開発者が識別するのに役立つメッセージをログに記録するために使用されます。
デバッグセッション中に発生する問題。 DEBUG で記録されるメッセージの内容
レベルはアプリケーションによって異なりますが、通常は次のものが含まれます。
開発者が問題をトラブルシューティングするのに役立つ詳細情報
効率的に。これには、周囲のスコープ内の変数の状態が含まれる場合があります。
関連するエラーコード。 |

## インスピレーション

このアイデアは、以下にリンクされている @christian1980nrw プロジェクトからインスピレーションを得ています。このプロジェクトは Victron Venus OS を使用する初めてのプロジェクトなので、次のプロジェクトからいくつかのアイデアとアプローチを採用しました。アプローチは同じで、非常に狭いシステムの場合は、bash スクリプトを使用した実装の方がおそらく優れています。

##### – 知識を伝えていただきありがとうございます:

-   [スポットマーケットスイッチャー](https://github.com/christian1980nrw/Spotmarket-Switcher)
-   [ダイナミックエス](https://github.com/tfranssen/dynamic-ess)
